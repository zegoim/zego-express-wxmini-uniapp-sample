{"version":3,"sources":["uni-app:///main.js","webpack:////Applications/project/uniapp-sample/pages/mix/mix.vue?a5b7","webpack:////Applications/project/uniapp-sample/pages/mix/mix.vue?a0bd","webpack:////Applications/project/uniapp-sample/pages/mix/mix.vue?6f05","webpack:////Applications/project/uniapp-sample/pages/mix/mix.vue?8006","uni-app:///pages/mix/mix.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,sF,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,YAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAgH;AAChH;AACuD;AACL;;;AAGlD;AAC0L;AAC1L,gBAAgB,oMAAU;AAC1B,EAAE,yEAAM;AACR,EAAE,8EAAM;AACR,EAAE,uFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,kFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAmtB,CAAgB,guBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC+CvuB;AACA,gE;;AAEA,mB,CAAA,S,sBAAA,S,CAAA,M,sBAAA,M;AACA,O;AACA;AACA,gCADA,EACA;AACA,MAFA,kBAEA;AACA;AACA,2BADA;AAEA,qDAFA;AAGA,mDAHA;AAIA,uBAJA;;AAMA,GATA;AAUA,SAVA,qBAUA;AACA;AACA,kBAFA,CAEA;AACA,GAbA;AAcA,QAdA,oBAcA;AACA;AACA;AACA;AACA;AACA;AACA,kBANA,CAMA;AACA;AACA;AACA;AACA,GAxBA;AAyBA;AACA,aADA,uBACA;AACA,6DADA;AAEA,oCAFA;AAGA,yBAHA,GAGA;AACA,8CADA;AAEA,sCAFA;AAGA;AACA,0BADA;AAEA,2BAFA;AAGA,+BAHA;AAIA,8BAJA,EAHA,GAHA;;;AAaA;AACA,8BADA,GACA,uBADA;AAEA;AACA,mDADA;AAEA,wCAFA;AAGA;AACA,8BADA;AAEA,6BAFA;AAGA,iCAHA;AAIA,gCAJA,EAHA;;;AAUA;AACA,0BA1BA,GA0BA;AACA,2CADA,GA1BA;;AA6BA,4BA7BA,GA6BA;AACA,2CADA;AAEA,+BAFA;AAGA,kCAHA;AAIA,mCAJA,EA7BA;;AAmCA,wBAnCA,GAmCA;AACA,yCADA;AAEA,sCAFA;AAGA,wCAHA;AAIA,4CAJA,EAnCA;;AAyCA,kDAzCA;;AA2CA,6CA3CA,UA2CA,MA3CA;AA4CA;AACA,8BA7CA,GA6CA,EA7CA;AA8CA;AACA;AACA,iBAhDA;AAiDA,2EAjDA,gDAiDA,QAjDA,yBAiDA,QAjDA,CAiDA,GAjDA,yBAiDA,GAjDA;AAkDA;AACA;AACA,oCADA;AAEA,0BAFA;;AAIA,qDAvDA;;AAyDA,kDAzDA;AA0DA,iBA1DA;;;AA6DA,mDA7DA,gDA6DA,SA7DA,yBA6DA,SA7DA;AA8DA;AACA;AACA;AACA;AACA,mBAFA;AAGA;AACA,iBApEA;;AAsEA,sDAtEA;;;;AA0EA,KA3EA,EAzBA,E","file":"pages/mix/mix.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/mix/mix.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./mix.vue?vue&type=template&id=5db87740&\"\nvar renderjs\nimport script from \"./mix.vue?vue&type=script&lang=js&\"\nexport * from \"./mix.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/mix/mix.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./mix.vue?vue&type=template&id=5db87740&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./mix.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./mix.vue?vue&type=script&lang=js&\"","<template>\n    <view class=\"page-content\">\n        <view v-if=\"canShow == 1\">\n            <view class=\"live-wrapper\">\n                <view class=\"containerBase\">\n                    <live-pusher v-if=\"livePusherUrl\" :url=\"livePusherUrl\" aspect=\"3:4\" @statechange=\"onPushStateChange\"\n                        @netstatus=\"onPushNetStateChange\"\n                        waiting-image=\"https://storage.zego.im/downloads/pause_publish.png\"></live-pusher>\n                    <live-player v-for=\"item in livePlayerList\" :key=\"item.streamID\" :id=\"item.streamID\" :src=\"item.url\"\n                        mode=\"RTC\" autoplay @statechange=\"onPlayStateChange\" @netstatus=\"onPlayNetStateChange\">\n                    </live-player>\n                </view>\n                <view class=\"containerBase\">\n                    <live-player v-for=\"item in mixPlayerUrls\" :key=\"item.streamID\" :id=\"item.streamID\" :src=\"item.url\"\n                        mode=\"RTC\" autoplay @statechange=\"onPlayStateChange\" @netstatus=\"onPlayNetStateChange\">\n                    </live-player>\n                </view>\n            </view>\n            <view class=\"index-container\">\n                <view class='input-container'>\n                    <input v-model=\"roomID\" placeholder=\"请输入房间 ID\" placeholder-style='color: #b3b3b3; font-size: 14px;'\n                        class=\"room-input\" />\n                    <text class=\"tip\"></text>\n                </view>\n                <view class=\"button-container\">\n                    <button @tap=\"openRoom\" data-role=\"1\" hover-class=\"none\" class=\"util-btn\">\n                        加入房间(推流)\n                    </button>\n                    <button @tap=\"openRoom\" data-role=\"0\" hover-class=\"none\" class=\"util-btn\">\n                        加入房间(不推流)\n                    </button>\n                    <button @tap=\"mixStream\" class=\"util-btn\">\n                        {{ mixStreamStart ? '停止混流' : '开始混流' }}\n                    </button>\n                    <!-- <button @tap=\"logout\" class=\"util-btn\" hover-class=\"none\">退出房间</button> -->\n                </view>\n            </view>\n        </view>\n        <view class=\"settings\">\n            <button v-if=\"canShow == 0\" open-type=\"openSetting\" @opensetting=\"settingCallback\">\n                授权使用摄像头和麦克风\n            </button>\n        </view>\n    </view>\n</template>\n\n<script>\nimport commonMixin from '../../mixin/common-mixin'\nimport { initSDK, authCheck } from '../../utils/common';\n\nlet { zegoAppID, server } = getApp().globalData;\nlet zg;\nexport default {\n    mixins: [commonMixin], // 方法混合，包含登录房间，推拉流，退出房间\n    data() {\n        return {\n            mixStreamStart: false,\n            mixStreamID: 'xcx-mixS-' + new Date().getTime(),\n            mixTaskID: 'xcx-mixT-' + new Date().getTime(),\n            mixPlayerUrls: []\n        }\n    },\n    onReady() {\n        zg = initSDK(this);\n        this._zg = zg // _zg不监听，监听会报错\n    },\n    onShow() {\n        console.log('server: ', server);\n        authCheck(this);\n        if (zg && this.roomID) {\n            this.reLogin();\n        }\n        this._zg = zg // _zg不监听，监听会报错\n        // 刷新全局变量\n        zegoAppID = getApp().globalData.zegoAppID;\n        server = getApp().globalData.server;\n    },\n    methods: {\n        async mixStream() {\n            this.mixStreamStart = !this.mixStreamStart\n            if (this.mixStreamStart) {\n                const inputList = [{\n                    streamID: this.pushStreamID,\n                    contentType: 'video',\n                    layout: {\n                        top: 0,\n                        left: 0,\n                        bottom: 480,\n                        right: 640,\n                    }\n                }];\n                if (this.livePlayerList.length > 0) {\n                    const playerStream = this.livePlayerList[0]\n                    inputList.push({\n                        streamID: playerStream.streamID,\n                        contentType: 'video',\n                        layout: {\n                            top: 480,\n                            left: 0,\n                            bottom: 960,\n                            right: 640\n                        }\n                    });\n                }\n                const outputList = [{\n                    target: this.mixStreamID,\n                }]\n                const outputConfig = {\n                    outputBitrate: 800 * 1000,\n                    outputFPS: 15,\n                    outputWidth: 640,\n                    outputHeight: 960,\n                }\n                const mixParam = {\n                    taskID: this.mixTaskID,\n                    inputList: inputList,\n                    outputList,\n                    outputConfig\n                };\n                console.log('mixParam', mixParam);\n                try {\n                    const result = await zg.startMixerTask(mixParam)\n                    console.log('mixPlayInfoList: ', result);\n                    const _mixPlayerUrls = []\n                    if (result.errorCode !== 0) {\n                        console.error('mix fail', result);\n                    }\n                    const { streamID, url } = await zg.startPlayingStream(this.mixStreamID, { isMix: true })\n                    console.log('>>>[liveroom-room] startPlayingStream, streamID: ', streamID, ' url: ', url);\n                    _mixPlayerUrls.push({\n                        streamID,\n                        url\n                    })\n                    this.mixPlayerUrls =  _mixPlayerUrls\n                } catch (err) {\n                    console.log('err: ', err);\n                };\n            } else {\n                try {\n                    const { errorCode } = await zg.stopMixerTask(this.mixTaskID)\n                    console.log('stopMixerTask ', errorCode)\n                    if (this.mixPlayerUrls.length > 0) {\n                        this.mixPlayerUrls.forEach((item) => {\n                            zg.stopPlayingStream(item.streamID);\n                        })\n                        this.mixPlayerUrls = []\n                    }\n                } catch (error) {\n                    console.error('error: ', error);\n                }\n\n            }\n        },\n    }\n}\n</script>\n\n<style>\n</style>"],"sourceRoot":""}